# TownPet 개발 블로그 메모

캠프파이어 버전 설명서였던 걸 블로그 톤으로 다시 적는 중임.
짧게, 메모처럼 남기는 포맷임.

## 한 줄 정의
Local은 동네 빠른 정보, Global은 지식 축적임.
둘을 섞으면 제품도 기술도 망가짐.

## 아키텍처 감각
UI가 주문 받고, 서버가 조리 계획 세우는 구조임.
Services가 정책 담당, Prisma가 창고 역할임.

흐름은 이렇게 돌고 있음.

Client UI
-> Route Handlers 또는 Server Actions
-> Services (정책/검증)
-> Prisma
-> PostgreSQL

서비스 레이어는 선택이 아니라 기본임.
여기서 정책이 끊기면 엔드포인트마다 복붙 지옥됨.

## 폴더 구조 감각
- `src/app/` 정문임. 페이지/라우트 있음.
- `src/server/services/` 두뇌임. 정책은 여기로.
- `src/server/actions/` 쓰기 작업임.
- `src/server/queries/` 읽기 최적화임.
- `src/lib/validations/` Zod 스키마 자리임.
- `prisma/schema.prisma` 계약서임.

순서 헷갈리면 이렇게 함.
Prisma -> Zod -> Service -> Action/Route -> UI -> Tests.

## 스택 요약
TypeScript 단일 언어임.
Next.js App Router로 UI/API/SSR 한 번에 처리함.
Prisma + Zod로 타입과 런타임 둘 다 잡는 구조임.
Tailwind + shadcn/ui로 UI 빠르게 뽑는 전략임.
Vercel/Supabase/Upstash로 운영 부담 줄였음.

## 도메인 규칙 메모
Local/Global 분리 규칙은 진짜 하드룰임.
마켓/돌봄/실종은 정책이 먼저임.
신고는 자동 블라인드 + 관리자 로그 필수임.
레이트리밋/신규 제한은 기본 옵션이 아니라 기본값임.
템플릿 기반 UGC가 먼저, 자유서술은 후순위임.

## 개발 리듬
PLAN -> SCHEMA -> GENERATE -> REVIEW -> TEST -> DEPLOY 흐름임.
현실에선 데이터 -> 검증 -> 정책 -> 인터페이스 -> UI 순서임.
정책 빠지면 기능 완성 아님.

## 실제 버그 메모
Prisma 7에서 adapter 요구 때문에 로컬 스크립트 깨졌음.
Prisma 5.x로 고정했음.
Node 20.18에서 Prisma 설치 실패했음.
최소 Node 버전 올렸음.

## 피해야 할 함정
Local/Global 섞기 금지임.
레이트리밋/신고 없이 기능만 추가하면 바로 어뷰징됨.
검증을 UI에 숨기면 서버에서 터짐.
select/include 안 쓰면 N+1 지옥임.

## 좋은 엔지니어 감각
규칙은 지루할수록 좋음.
정책은 옵션이 아니라 제품임.
작게 바꿔야 AI도 잘 돕는 구조임.
실수는 문서에 남겨서 한 번만 겪는 게 목표임.

## 비즈니스/제품 메모
기술 설계랑 제품 논리는 한 몸임.
왜 먼저 만드는지 이해해야 구현 순서가 보임.

문제 정의:
- Local: 최신성/신뢰성이 낮아 의사결정 비용 큼.
- Global: 지식은 축적될수록 가치가 커지는데 섞이면 혼탁해짐.

핵심 원칙:
- Local/Global을 탭/검색/알림/정책까지 분리함.
- 템플릿 기반 UGC로 데이터 품질 고정함.
- 운영 자동화가 제품 일부임.

페르소나 메모:
- 초보 보호자: 확신 필요함. 비용/대기 민감함.
- 다견/다묘: 비용 최적화 핵심임. 분쟁 리스크 큼.
- 긴급 돌봄: 속도/신뢰가 최우선임. 증빙 필수임.
- 로컬 업체: 광고보다 신뢰 표기가 중요함.

수익화 방향:
- 초기 목표는 리텐션/UGC 축적임.
- 광고/부스팅 -> 구독 -> 거래 수수료 순서임.
- 결제는 분쟁/환불 프로세스 정착 후임.

지표 감각:
- Local: 7일 리텐션, 템플릿 완성률, 저장/검색 사용률임.
- Global: 답변 수, 채택률, 검색 유입, 체류 시간임.

## 이 문서 유지법
새 아키텍처 결정 이유 적어두는 중임.
예상 못한 버그와 해결 과정 계속 기록할 예정임.
새 기술 도입과 트레이드오프 정리할 거임.
운영 사고나 사용자 피드백에서 배운 것 계속 추가할 거임.
